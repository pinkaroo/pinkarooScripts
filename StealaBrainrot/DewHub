local user_input_service = game:GetService("UserInputService")
local tween_service = game:GetService("TweenService")
local players = game:GetService("Players")
local replicated_storage = game:GetService("ReplicatedStorage")
local proximity_prompt_service = game:GetService("ProximityPromptService")
local stats = game:GetService("Stats")
local workspace = game:GetService("Workspace")
local local_player = players.LocalPlayer
local player_gui = local_player:WaitForChild("PlayerGui")
local plots = workspace:WaitForChild("Plots", 9e9)
local steal_remote = replicated_storage:WaitForChild("Packages"):WaitForChild("Net"):WaitForChild("RE/22f715d7-f287-4bbf-96d5-fb14e461dd75")
local plot_controller = require(replicated_storage.Controllers.PlotController)
local player_base = plot_controller.GetMyPlot().PlotModel

local screen_gui = Instance.new("ScreenGui")
screen_gui.Name = "DewHub"
screen_gui.ResetOnSpawn = false
screen_gui.Parent = player_gui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 250)
frame.Position = UDim2.new(1, -220, 0.5, -125)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.ClipsDescendants = true
frame.Parent = screen_gui

local ui_corner = Instance.new("UICorner")
ui_corner.CornerRadius = UDim.new(0, 10)
ui_corner.Parent = frame

local ui_stroke = Instance.new("UIStroke")
ui_stroke.Thickness = 2
ui_stroke.Color = Color3.fromRGB(0, 0, 0)
ui_stroke.Transparency = 0.5
ui_stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
ui_stroke.Parent = frame

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundTransparency = 1
title.Text = "Dew Hub"
title.TextColor3 = Color3.fromRGB(0, 255, 127)
title.TextSize = 24
title.Font = Enum.Font.GothamBold
title.Parent = frame

local toggle_frame = Instance.new("Frame")
toggle_frame.Size = UDim2.new(1, -20, 0, 40)
toggle_frame.Position = UDim2.new(0, 10, 0, 50)
toggle_frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
toggle_frame.Parent = frame

local toggle_corner = Instance.new("UICorner")
toggle_corner.CornerRadius = UDim.new(0, 8)
toggle_corner.Parent = toggle_frame

local toggle_label = Instance.new("TextLabel")
toggle_label.Size = UDim2.new(0.7, 0, 1, 0)
toggle_label.Position = UDim2.new(0, 10, 0, 0)
toggle_label.BackgroundTransparency = 1
toggle_label.Text = "Invis Steal"
toggle_label.TextColor3 = Color3.fromRGB(255, 255, 255)
toggle_label.TextSize = 16
toggle_label.Font = Enum.Font.Gotham
toggle_label.TextXAlignment = Enum.TextXAlignment.Left
toggle_label.Parent = toggle_frame

local toggle_button = Instance.new("TextButton")
toggle_button.Size = UDim2.new(0, 50, 0, 20)
toggle_button.Position = UDim2.new(1, -60, 0.5, -10)
toggle_button.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
toggle_button.Text = ""
toggle_button.Parent = toggle_frame

local toggle_corner_2 = Instance.new("UICorner")
toggle_corner_2.CornerRadius = UDim.new(0, 10)
toggle_corner_2.Parent = toggle_button

local toggle_state = false

local toggle_circle = Instance.new("Frame")
toggle_circle.Size = UDim2.new(0, 16, 0, 16)
toggle_circle.Position = UDim2.new(0, 2, 0.5, -8)
toggle_circle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
toggle_circle.Parent = toggle_button

local toggle_circle_corner = Instance.new("UICorner")
toggle_circle_corner.CornerRadius = UDim.new(0, 8)
toggle_circle_corner.Parent = toggle_circle

local teleport_button = Instance.new("TextButton")
teleport_button.Size = UDim2.new(1, -20, 0, 40)
teleport_button.Position = UDim2.new(0, 10, 0, 100)
teleport_button.BackgroundColor3 = Color3.fromRGB(0, 255, 127)
teleport_button.Text = "Teleport to Best Brainrot (PATCHED)"
teleport_button.TextColor3 = Color3.fromRGB(0, 0, 0)
teleport_button.TextSize = 16
teleport_button.Font = Enum.Font.Gotham
teleport_button.Parent = frame

local teleport_corner = Instance.new("UICorner")
teleport_corner.CornerRadius = UDim.new(0, 8)
teleport_corner.Parent = teleport_button

local dragging = false
local drag_start = nil
local start_pos = nil

local function convert_to_number(str)
    local num_str = str:gsub("%$", ""):gsub("/s", "")
    local multiplier = 1
    if num_str:find("K") then
        multiplier = 1e3
    elseif num_str:find("M") then
        multiplier = 1e6
    elseif num_str:find("B") then
        multiplier = 1e9
    elseif num_str:find("T") then
        multiplier = 1e12
    end
    num_str = num_str:gsub("[KMBT]", "")
    local number = tonumber(num_str)
    if number then
        return number * multiplier
    end
    return 0
end

local function get_best_brainrots()
    local best_brainrots = {}
    for _, v in pairs(plots:GetDescendants()) do
        if not v:IsDescendantOf(player_base) and v.Name == "Generation" and v:IsA("TextLabel") and v.Parent:IsA("BillboardGui") then
            local amount = convert_to_number(v.Text)
            table.insert(best_brainrots, {
                name = v.Parent.DisplayName.Text,
                spawn = v.Parent.Parent.Parent,
                label = v,
                actor = v.Parent.Parent.Parent.Parent.Parent.Parent.Parent:FindFirstChild(v.Parent.DisplayName.Text),
                amount = amount,
                real_amount = v.Text
            })
        end
    end
    table.sort(best_brainrots, function(a, b)
        return a.amount > b.amount
    end)
    return best_brainrots
end

local function get_ping()
    local ping_stat = stats.Network.ServerStatsItem["Data Ping"]
    return ping_stat and (ping_stat:GetValue() / 1000) or 0.1
end

local function teleport_to_best_brainrot()
    local best_brainrot = get_best_brainrots()[1]
    if best_brainrot and best_brainrot.actor then
        steal_remote:FireServer(workspace:GetServerTimeNow() + 62, "b3505eaa-0def-479d-9f39-489ac03fa81e")
        local steal_prompt
        for i, v in pairs(best_brainrot.spawn.PromptAttachment:GetChildren()) do
            if v:IsA("ProximityPrompt") and v.ActionText == "Steal" then
                steal_prompt = v
                break
            end
        end
        local tool = local_player.Backpack:FindFirstChild("Quantum Cloner") or local_player.Character:FindFirstChild("Quantum Cloner")
        if not tool then
            warn("No tool bro")
            return
        end
        if workspace:FindFirstChild(local_player.UserId .. "_Clone") then
            workspace:FindFirstChild(local_player.UserId .. "_Clone"):Destroy()
        end
        local_player.Character.Humanoid:EquipTool(tool)
        task.wait()
        replicated_storage.Packages.Net["RE/UseItem"]:FireServer()
        local clone = workspace:FindFirstChild(local_player.UserId .. "_Clone")
        while not clone do
            replicated_storage.Packages.Net["RE/UseItem"]:FireServer()
            task.wait()
            clone = workspace:FindFirstChild(local_player.UserId .. "_Clone")
        end
        if setsimulationradius then
            setsimulationradius(math.huge)
        end
        task.wait(0.5)
        replicated_storage.Packages.Net["RE/QuantumCloner/OnTeleport"]:FireServer()
        local clone_pos = clone.HumanoidRootPart and clone.HumanoidRootPart.Position
        if not clone_pos then
            warn("Clone has no HumanoidRootPart")
            return
        end
        local start = tick()
        while (local_player.Character.HumanoidRootPart.Position - clone_pos).Magnitude > 15 and tick() - start < 2 do
            if clone.HumanoidRootPart then
                clone:PivotTo(best_brainrot.spawn.CFrame)
                clone:SetNetworkOwner(local_player)
            end
            task.wait()
        end
        if tick() - start > 2 then
            return warn("Failed to TP")
        end
        task.wait(0.2)
        fireproximityprompt(steal_prompt)
    end
end

local invis_steal_connection
local function toggle_invis_steal()
    if toggle_state and not invis_steal_connection then
        invis_steal_connection = proximity_prompt_service.PromptTriggered:Connect(function(prompt, player)
            if player ~= local_player then
                return
            end
            repeat task.wait() until player:GetAttribute("Stealing")
            replicatesignal(player.Character.Humanoid.ServerBreakJoints)
            player.Character:PivotTo(player.Character.PrimaryPart.CFrame * CFrame.new(0, -99, 0))
        end)
    elseif not toggle_state and invis_steal_connection then
        invis_steal_connection:Disconnect()
        invis_steal_connection = nil
    end
end

local function save_config()
    writefile("dewhub_sab", tostring(toggle_state))
end

local function load_config()
    if isfile("dewhub_sab") then
        local content = readfile("dewhub_sab")
        toggle_state = content == "true"
        update_toggle()
        toggle_invis_steal()
    end
end

frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        drag_start = input.Position
        start_pos = frame.Position
    end
end)

frame.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - drag_start
        frame.Position = UDim2.new(start_pos.X.Scale, start_pos.X.Offset + delta.X, start_pos.Y.Scale, start_pos.Y.Offset + delta.Y)
    end
end)

user_input_service.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

local function update_toggle()
    local tween_info = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local goal = toggle_state and {Position = UDim2.new(1, -18, 0.5, -8)} or {Position = UDim2.new(0, 2, 0.5, -8)}
    local color_goal = toggle_state and {BackgroundColor3 = Color3.fromRGB(0, 255, 127)} or {BackgroundColor3 = Color3.fromRGB(100, 100, 100)}
    tween_service:Create(toggle_circle, tween_info, goal):Play()
    tween_service:Create(toggle_button, tween_info, color_goal):Play()
end

toggle_button.MouseButton1Click:Connect(function()
    toggle_state = not toggle_state
    update_toggle()
    toggle_invis_steal()
    save_config()
end)

teleport_button.MouseButton1Click:Connect(function()
    local tween_info = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut)
    tween_service:Create(teleport_button, tween_info, {BackgroundColor3 = Color3.fromRGB(0, 200, 100)}):Play()
    task.wait(0.2)
    tween_service:Create(teleport_button, tween_info, {BackgroundColor3 = Color3.fromRGB(0, 255, 127)}):Play()
    teleport_to_best_brainrot()
end)

frame.Position = UDim2.new(1, -220, 0.5, -125)
frame.Size = UDim2.new(0, 0, 0, 0)
local tween_info = TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
tween_service:Create(frame, tween_info, {Size = UDim2.new(0, 200, 0, 250)}):Play()

load_config()
